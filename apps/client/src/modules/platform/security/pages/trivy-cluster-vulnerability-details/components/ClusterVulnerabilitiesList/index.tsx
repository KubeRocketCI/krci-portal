import { DataTable } from "@/core/components/Table";
import { TABLE } from "@/k8s/constants/tables";
import { useVulnerabilitiesColumns } from "../../hooks/useVulnerabilitiesColumns";
import { ClusterVulnerabilityReport } from "@my-project/shared";
import { EmptyList } from "@/core/components/EmptyList";
import { useMemo } from "react";
import { ClusterVulnerabilityWithId } from "../../types";

interface ClusterVulnerabilitiesListProps {
  report: ClusterVulnerabilityReport | undefined;
  isLoading: boolean;
}

/**
 * ClusterVulnerabilitiesList component displays a table of CVE vulnerabilities
 * for a cluster-scoped vulnerability report.
 */
export function ClusterVulnerabilitiesList({ report, isLoading }: ClusterVulnerabilitiesListProps) {
  const columns = useVulnerabilitiesColumns();

  const vulnerabilities: ClusterVulnerabilityWithId[] = useMemo(() => {
    return (report?.report.vulnerabilities ?? []).map((vuln, index) => ({
      ...vuln,
      id: `${vuln.vulnerabilityID}-${index}`,
    }));
  }, [report]);

  return (
    <DataTable<ClusterVulnerabilityWithId>
      id={TABLE.TRIVY_CLUSTER_VULNERABILITIES_LIST.id}
      data={vulnerabilities}
      columns={columns}
      isLoading={isLoading}
      emptyListComponent={
        <EmptyList
          customText="No vulnerabilities found"
          description="This container image has no known vulnerabilities"
        />
      }
      sort={{
        order: "desc",
        sortBy: "severity",
      }}
      pagination={{
        show: true,
      }}
      settings={{
        show: true,
      }}
    />
  );
}
