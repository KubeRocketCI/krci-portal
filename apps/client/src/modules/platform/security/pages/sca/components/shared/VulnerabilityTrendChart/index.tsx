import { PortfolioMetrics } from "@my-project/shared";
import { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, Legend } from "recharts";
import { Loader2 } from "lucide-react";
import { SEVERITY_COLORS, CHART_COLORS } from "../../../constants/colors";
import { transformToChartData } from "../../../utils/metrics";
import { LabeledValueChartTooltip } from "../ChartTooltip";

export interface VulnerabilityTrendChartProps {
  metrics: PortfolioMetrics[] | undefined;
  isLoading?: boolean;
}

export function VulnerabilityTrendChart({ metrics, isLoading }: VulnerabilityTrendChartProps) {
  const chartData = metrics ? transformToChartData(metrics) : [];

  if (isLoading) {
    return (
      <div className="flex h-[200px] items-center justify-center">
        <Loader2 className="text-muted-foreground size-8 animate-spin" />
      </div>
    );
  }

  if (chartData.length === 0) {
    return <div className="text-muted-foreground flex h-[200px] items-center justify-center">No data available</div>;
  }

  return (
    <ResponsiveContainer width="100%" height={200}>
      <LineChart data={chartData}>
        <XAxis dataKey="timestamp" tick={{ fontSize: 12 }} stroke={CHART_COLORS.AXIS_STROKE} />
        <YAxis tick={{ fontSize: 12 }} stroke={CHART_COLORS.AXIS_STROKE} />
        <Tooltip
          content={
            <LabeledValueChartTooltip
              labels={[
                { key: "critical", label: "Critical", color: SEVERITY_COLORS.CRITICAL },
                { key: "high", label: "High", color: SEVERITY_COLORS.HIGH },
                { key: "medium", label: "Medium", color: SEVERITY_COLORS.MEDIUM },
                { key: "low", label: "Low", color: SEVERITY_COLORS.LOW },
                { key: "unassigned", label: "Unassigned", color: SEVERITY_COLORS.UNASSIGNED },
              ]}
            />
          }
        />
        <Legend wrapperStyle={{ fontSize: "12px" }} iconType="line" />
        <Line
          type="monotone"
          dataKey="critical"
          name="Critical"
          stroke={SEVERITY_COLORS.CRITICAL}
          strokeWidth={2}
          dot={false}
        />
        <Line type="monotone" dataKey="high" name="High" stroke={SEVERITY_COLORS.HIGH} strokeWidth={2} dot={false} />
        <Line
          type="monotone"
          dataKey="medium"
          name="Medium"
          stroke={SEVERITY_COLORS.MEDIUM}
          strokeWidth={2}
          dot={false}
        />
        <Line type="monotone" dataKey="low" name="Low" stroke={SEVERITY_COLORS.LOW} strokeWidth={2} dot={false} />
        <Line
          type="monotone"
          dataKey="unassigned"
          name="Unassigned"
          stroke={SEVERITY_COLORS.UNASSIGNED}
          strokeWidth={2}
          dot={false}
        />
      </LineChart>
    </ResponsiveContainer>
  );
}
