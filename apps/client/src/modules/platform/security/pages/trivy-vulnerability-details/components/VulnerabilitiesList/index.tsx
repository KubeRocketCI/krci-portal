import { DataTable } from "@/core/components/Table";
import { TABLE } from "@/k8s/constants/tables";
import { useVulnerabilitiesColumns } from "../../hooks/useVulnerabilitiesColumns";
import { VulnerabilityReport, Vulnerability } from "@my-project/shared";
import { EmptyList } from "@/core/components/EmptyList";
import { useMemo } from "react";

interface VulnerabilitiesListProps {
  report: VulnerabilityReport | undefined;
  isLoading: boolean;
}

/**
 * VulnerabilitiesList component displays a table of CVE vulnerabilities.
 */
export function VulnerabilitiesList({ report, isLoading }: VulnerabilitiesListProps) {
  const columns = useVulnerabilitiesColumns();

  const vulnerabilities: Vulnerability[] = useMemo(() => {
    return report?.report.vulnerabilities ?? [];
  }, [report]);

  return (
    <DataTable
      id={TABLE.TRIVY_VULNERABILITIES_LIST.id}
      data={vulnerabilities}
      columns={columns}
      isLoading={isLoading}
      emptyListComponent={
        <EmptyList
          customText="No vulnerabilities found"
          description="This container image has no known vulnerabilities"
        />
      }
      sort={{
        order: "desc",
        sortBy: "severity",
      }}
      pagination={{
        show: true,
      }}
      settings={{
        show: true,
      }}
    />
  );
}
